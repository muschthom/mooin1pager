define("format_mooin1pager/section",["exports","core/reactive","core_courseformat/courseeditor","core/templates","format_mooin1pager/ildhvp4"],(function(_exports,_reactive,_courseeditor,_templates,_ildhvp){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Format mooin1pager section extra logic component.
   *
   * @module     format_mooin1pager/section
   * @copyright  2022 Ferran Recio <ferran@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=_interopRequireDefault(_templates),_ildhvp=_interopRequireDefault(_ildhvp);class HighlightSection extends _reactive.BaseComponent{create(){this.name="format_mooin1pager_section",this.selectors={SETMARKER:'[data-action="sectionHighlight"]',REMOVEMARKER:'[data-action="sectionUnhighlight"]',ACTIONTEXT:".menu-action-text",ICON:".icon"},this.classes={HIDE:"d-none"},this.formatActions={HIGHLIGHT:"sectionHighlight",UNHIGHLIGHT:"sectionUnhighlight"}}getWatchers(){return[{watch:"section.current:updated",handler:this._refreshHighlight}]}async _refreshHighlight(_ref){var _affectedAction$datas,_affectedAction$datas2;let selector,newAction,{element:element}=_ref;element.current?(selector=this.selectors.SETMARKER,newAction=this.formatActions.UNHIGHLIGHT):(selector=this.selectors.REMOVEMARKER,newAction=this.formatActions.HIGHLIGHT);const affectedAction=this.getElement("".concat(selector),element.id);if(!affectedAction)return;affectedAction.dataset.action=newAction;const actionText=affectedAction.querySelector(this.selectors.ACTIONTEXT);if(null!==(_affectedAction$datas=affectedAction.dataset)&&void 0!==_affectedAction$datas&&_affectedAction$datas.swapname&&actionText){const oldText=null==actionText?void 0:actionText.innerText;actionText.innerText=affectedAction.dataset.swapname,affectedAction.dataset.swapname=oldText}const icon=affectedAction.querySelector(this.selectors.ICON);if(null!==(_affectedAction$datas2=affectedAction.dataset)&&void 0!==_affectedAction$datas2&&_affectedAction$datas2.swapicon&&icon){const newIcon=affectedAction.dataset.swapicon;if(newIcon){const pixHtml=await _templates.default.renderPix(newIcon,"core");_templates.default.replaceNode(icon,pixHtml,""),affectedAction.dataset.swapicon=affectedAction.dataset.icon,affectedAction.dataset.icon=newIcon}}}stateReady(state){this._hvpListener()}_hvpListener(){var h5p_contentIds=[],parentIFrames=this.getElements(this.selectors.H5P);parentIFrames.length>0&&parentIFrames.forEach((parentIFrame=>{if(parentIFrame.contentDocument){var parentIFrameContent=parentIFrame.contentDocument||parentIFrame.contentWindow.document;let nestedIFrame=null;const adjustParentIFrameHeight=()=>{setTimeout((()=>{if(console.log("adjustParentIFrameHeight"),nestedIFrame&&nestedIFrame.contentWindow.document.body){const nestedIFrameHeight=nestedIFrame.contentWindow.document.body.scrollHeight;nestedIFrameHeight>1&&(parentIFrame.style.height=nestedIFrameHeight+"px")}}),100)},monitorElementLoads=()=>{console.log("monitorElementLoads");["img","video","iframe","embed","object"].forEach((tag=>{const elements=nestedIFrame.contentDocument.getElementsByTagName(tag);for(let element of elements)element.addEventListener("load",adjustParentIFrameHeight),element.addEventListener("resize",adjustParentIFrameHeight)}))},checkForH5P=()=>{if(console.log("checkForH5P"),nestedIFrame){var H5PIntegration=nestedIFrame.contentWindow.H5PIntegration,H5P=nestedIFrame.contentWindow.H5P;if(H5P&&H5P.externalDispatcher){if(H5P.setFinished=function(contentId,score,maxScore,time){},!h5p_contentIds.includes(H5P.instances[0].contentId)){array=h5p_contentIds,element=H5P.instances[0].contentId,array.includes(element)||array.push(element);_ildhvp.default.init(H5P,H5PIntegration,this.id,this.reactive)}return adjustParentIFrameHeight(),new MutationObserver((function(mutations){mutations.forEach((function(mutation){(mutation.addedNodes.length>0||"src"===mutation.attributeName)&&adjustParentIFrameHeight()}))})).observe(nestedIFrame.contentDocument,{childList:!0,subtree:!0,attributes:!0}),!0}}var array,element;return!1},checkForNestedIFrame=()=>{if(nestedIFrame=parentIFrameContent.querySelector(".h5p-iframe"),nestedIFrame){if(nestedIFrame.addEventListener("load",(function(){adjustParentIFrameHeight(),checkForH5P(),monitorElementLoads()})),!checkForH5P())var h5pCheckInterval=setInterval((function(){checkForH5P()&&clearInterval(h5pCheckInterval)}),500);return!0}return!1};if(!checkForNestedIFrame()){var observer=new MutationObserver((function(mutations){console.log("_hvpListener 7"),mutations.forEach((function(mutation){mutation.addedNodes.length>0&&checkForNestedIFrame()&&observer.disconnect()}))}));observer.observe(parentIFrameContent,{childList:!0,subtree:!0})}}}))}}_exports.init=()=>{const courseEditor=(0,_courseeditor.getCurrentCourseEditor)();courseEditor.supportComponents&&courseEditor.isEditing&&new HighlightSection({element:document.getElementById("page"),reactive:courseEditor})}}));

//# sourceMappingURL=section.min.js.map